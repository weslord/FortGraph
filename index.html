<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>Dwarf Force-tress</title>
  <style>
  html {
    box-sizing: border-box;
  }

  *, *:before, *:after {
    box-sizing: inherit;
  }

  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
  </style>
  <script src='lib/d3.js'></script>
</head>
<body>
<script>
{ // INIT
  var width = 960,
      height = 500;

  var svg = d3.select('body').append('svg')
      .attr('width', width)
      .attr('height', height);

  var circles = svg.selectAll("circle");

  vertices = [{x: width/2, y: height/2}]

  svg.on('dblclick', svgClick);
}

function svgClick () {
  var x = d3.mouse(this)[0];
  var y = d3.mouse(this)[1];

  vertices.push({x: x, y: y});

  circles = svg.selectAll("circle").data(vertices, function(d){return ''+d.x+'x'+d.y});
  var enter = circles.enter().append("circle")
      .attr('r', 5)
      .attr('cx', function (d) {return d.x})
      .attr('cy', function (d) {return d.y});
  circles = circles.merge(enter);

  //listeners get redefined in multiple places...
  circles.on('click', circleClick);
}

function circleClick (d, i) {
  console.log('circle clicked');
  console.log(d);
  console.log(i);

  vertices.splice(i, 1);

  circles = svg.selectAll("circle").data(vertices, function(d){return ''+d.x+'x'+d.y});
  circles.exit().remove();

  //listeners get redefined in multiple places...
  circles.on('click', circleClick);
}
</script>
</body>
