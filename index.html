<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>Dwarf Force-tress</title>
  <style>
  html {
    box-sizing: border-box;
  }

  *, *:before, *:after {
    box-sizing: inherit;
  }

  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
  </style>
  <script src='lib/d3.v5.js'></script>
</head>
<body>
<script>
{ // INIT
  var width = 960,
      height = 500;

  var svg = d3.select('body').append('svg')
      .attr('width', width)
      .attr('height', height);

  var circles = svg.selectAll('circle');

  var vertices = [
    {id: 0, x: width * 0.2, y: height * 0.4},
    {id: 1, x: width * 0.5, y: height * 0.5},
    {id: 2, x: width * 0.8, y: height * 0.6}
  ];
  var lastVertexId = 2;
  var edges = [{source: 0, target: 1}];

  svg.on('dblclick', svgClick);

  update();
}

function update() {
  circles = svg.selectAll('circle').data(vertices, function(d){return d.id});

  circles.exit().remove();

  var enter = circles.enter().append('circle')
      .attr('r', 25)
      .on('click', circleClick)
      .call(d3.drag()
        .on('drag', circleDrag)
      );

  circles = circles.merge(enter);


  lines = svg.selectAll('line')

  tick();
}

function tick() {
  circles
      .attr('cx', function (d) {return d.x})
      .attr('cy', function (d) {return d.y})
}

function svgClick() {
  var x = d3.mouse(this)[0];
  var y = d3.mouse(this)[1];

  vertices.push({id: ++lastVertexId, x: x, y: y});

  update();
}

function circleClick(d, i) {
  vertices.splice(vertices.indexOf(d), 1);

  update();
}

function circleDrag(d) {
  var vertex = vertices[vertices.indexOf(d)];
  vertex.x = d3.mouse(this)[0];
  vertex.y = d3.mouse(this)[1];

  tick();
}

</script>
</body>
